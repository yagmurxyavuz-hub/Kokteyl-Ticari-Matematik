<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Şişe & Kokteyl Maliyet</title>

<style>
body{font-family:system-ui;background:#f6f7fb;margin:0;display:flex;justify-content:center;align-items:center;min-height:100vh}
.card{background:#fff;width:min(650px,95%);padding:16px;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
label{font-size:12px;color:#555;margin-bottom:6px;display:block}
.input{border:1px solid #e3e6ee;border-radius:12px;padding:10px}
input{border:0;outline:0;width:100%;font-size:15px}
input[readonly]{background:#f1f5f9}
.grid{display:grid;gap:12px}
.result{margin-top:14px}
.tile{background:#0f172a;color:#fff;padding:12px;border-radius:12px;margin-bottom:8px}
.tile.light{background:#fff;color:#111;border:1px solid #e9edf6}
button{border:0;border-radius:12px;padding:12px;font-size:15px;cursor:pointer}
.primary{background:#4f46e5;color:#fff}

/* dropdown */
.dropdown{position:relative}
.dropdown-list{
  position:absolute;top:100%;left:0;right:0;
  background:#fff;border:1px solid #e3e6ee;
  border-radius:12px;max-height:220px;
  overflow:auto;display:none;z-index:10
}
.dropdown-item{padding:10px;cursor:pointer}
.dropdown-item:hover{background:#eef2ff}
</style>
</head>

<body>
<main class="card">
<h2>Şişe & Kokteyl Maliyet</h2>

<div class="grid">

<div>
<label>Ürün Seç</label>
<div class="dropdown">
  <div class="input">
    <input id="urunAra" placeholder="Ürün ara...">
  </div>
  <div id="urunListe" class="dropdown-list"></div>
</div>
</div>

<div>
<label>Şişe Fiyatı (₺)</label>
<div class="input"><input id="price" type="number"></div>
</div>

<div>
<label>İskonto (%)</label>
<div class="input"><input id="discount" type="number" value="0"></div>
</div>

<div>
<label>Şişe CL (dosyadan)</label>
<div class="input"><input id="bottleCL" readonly></div>
</div>

<hr>

<div>
<label>Kokteylde Kullanılan Alkol (CL)</label>
<div class="input"><input id="cocktailCL" type="number"></div>
</div>

<div>
<label>Diğer Tutarlar (₺)</label>
<div class="input"><input id="extra" type="number" value="0"></div>
</div>

<div>
<label>Kokteyl Satış Fiyatı (₺)</label>
<div class="input"><input id="sale" type="number"></div>
</div>

</div>

<section class="result">
<div class="tile"><div>Net Şişe Fiyatı</div><div id="netBottle">—</div></div>
<div class="tile light"><div>₺ / CL</div><div id="perCL">—</div></div>
<div class="tile"><div>Kokteyl Alkol Maliyeti</div><div id="alcoholCost">—</div></div>
<div class="tile light"><div>Toplam Kokteyl Maliyeti</div><div id="totalCost">—</div></div>
<div class="tile"><div>Maliyet Oranı</div><div id="ratio">—</div></div>
</section>

<button class="primary" onclick="calc()">Hesapla</button>
</main>

<script>
const urunAra=document.getElementById("urunAra");
const urunListe=document.getElementById("urunListe");
const priceEl=document.getElementById("price");
const bottleCLEl=document.getElementById("bottleCL");

let urunler=[];

/* CSV OKU */
fetch("urunler.csv")
.then(r=>r.text())
.then(t=>{
  const rows=t.trim().split("\n").slice(1);
  urunler=rows.map(r=>{
    const [ad,fiyat,cl]=r.split(",");
    return {ad,fiyat:+fiyat,cl:+cl};
  });
  renderList(urunler);
});

/* LISTE */
function renderList(list){
  urunListe.innerHTML="";
  list.forEach(u=>{
    const d=document.createElement("div");
    d.className="dropdown-item";
    d.textContent=u.ad;
    d.onclick=()=>{
      urunAra.value=u.ad;
      priceEl.value=u.fiyat;
      bottleCLEl.value=u.cl;
      urunListe.style.display="none";
      calc();
    };
    urunListe.appendChild(d);
  });
}

/* ARA */
urunAra.addEventListener("input",()=>{
  const q=urunAra.value.toLowerCase();
  renderList(urunler.filter(u=>u.ad.toLowerCase().includes(q)));
  urunListe.style.display="block";
});
urunAra.addEventListener("focus",()=>urunListe.style.display="block");
document.addEventListener("click",e=>{
  if(!e.target.closest(".dropdown")) urunListe.style.display="none";
});

/* HESAP */
function calc(){
  const price=+priceEl.value;
  const discountPct=+document.getElementById("discount").value;
  const bottleCL=+bottleCLEl.value;
  const cocktailCL=+document.getElementById("cocktailCL").value;
  const extra=+document.getElementById("extra").value;
  const sale=+document.getElementById("sale").value;

  const net=price - (price * discountPct / 100);
  const perCL=net / bottleCL;
  const alcoholCost=perCL * cocktailCL;
  const total=alcoholCost + extra;
  const ratio=sale ? (total/sale)*100 : 0;

  document.getElementById("netBottle").textContent=net?`₺ ${net.toFixed(2)}`:"—";
  document.getElementById("perCL").textContent=perCL?`₺ ${perCL.toFixed(2)}`:"—";
  document.getElementById("alcoholCost").textContent=alcoholCost?`₺ ${alcoholCost.toFixed(2)}`:"—";
  document.getElementById("totalCost").textContent=total?`₺ ${total.toFixed(2)}`:"—";
  document.getElementById("ratio").textContent=ratio?`% ${ratio.toFixed(1)}`:"—";
}
</script>
</body>
</html>
